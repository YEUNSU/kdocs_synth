# 한국 공문서 합성 데이터셋 생성기 (KDOCS_SYNTH)

## 🎯 프로젝트 개요

AI 문서 분류 모델 학습을 위한 한국 공문서 합성 데이터셋 생성기입니다. 주민등록등본(JU)과 가족관계증명서(GA)를 생성하며, 다양한 변형과 회전을 통해 총 400장의 이미지를 생성합니다.

## 📊 데이터셋 구성

### 전체 데이터셋: 400장 (회전 전)

#### 가족관계증명서 (GA): 160장
- **2개 템플릿** × **4개 가족구성** × **2개 주민번호방식** × **10장씩**
- 가족1: 본인,부,모,자녀0명 (20장) + 본인,부,모,배우자,자녀1명 (20장) + 본인,부,모,배우자,자녀2명 (20장) + 본인,부,모,배우자,자녀3명 (20장) = 80장
- 가족2: 본인,부,모,자녀0명 (20장) + 본인,부,모,배우자,자녀1명 (20장) + 본인,부,모,배우자,자녀2명 (20장) + 본인,부,모,배우자,자녀3명 (20장) = 80장

#### 주민등록등본 (JU): 240장
- **3개 등본** × **4개 바코드조합** × **2개 주민번호방식** × **10장씩**
- 등본1: 상단O하단O (20장) + 상단O하단X (20장) + 상단X하단O (20장) + 상단X하단X (20장) = 80장
- 등본2: 상단O하단O (20장) + 상단O하단X (20장) + 상단X하단O (20장) + 상단X하단X (20장) = 80장
- 등본3: 상단O하단O (20장) + 상단O하단X (20장) + 상단X하단O (20장) + 상단X하단X (20장) = 80장

## 📝 파일명 규칙

```
{문서구분}-{문서종류}-{주민번호공개여부}-{각도}-{순차번호5자리}
```

### 예시
```
GA-1-OPEN-0-00001.jpg    # 가족1, 주민번호공개, 정상
GA-1-CLOSE-0-00001.jpg   # 가족1, 주민번호미공개, 정상
JU-1-OPEN-0-00001.jpg    # 등본1, 주민번호공개, 정상
JU-1-CLOSE-0-00001.jpg   # 등본1, 주민번호미공개, 정상
```

## 🚀 설치 및 실행

### 1. 의존성 설치

#### 방법 1: pip + requirements.txt (권장)
```bash
pip install -r requirements.txt
```

#### 방법 2: uv + pyproject.toml
```bash
# uv 설치 (선택사항)
pip install uv

# 의존성 설치
uv sync
```

### 2. 데이터셋 생성
```bash
# 가족관계증명서(GA) 생성
python src/batch_generator_ga.py

# 주민등록등본(JU) 생성
python src/batch_generator.py
```

### 3. 회전 처리
```bash
# 0도 문서들을 L, R, 180도로 회전
python src/rotation_processor.py

# 또는 특정 디렉토리 지정
python src/rotation_processor.py --input outputs/dataset --output outputs/dataset
```

### 4. 레이아웃 추출 도구
```bash
python src/extract_layout.py
```

## 📂 프로젝트 구조

```
kdocs_synth/
├── assets/              # 리소스 파일
│   ├── fonts/          # 폰트 파일
│   ├── samples/        # 샘플 이미지
│   └── templates/      # 문서 템플릿
├── configs/            # 설정 파일
│   ├── field_definitions/  # 필드 정의
│   └── *_layout.yaml   # 레이아웃 좌표
├── src/                # 소스 코드
│   ├── data_factory.py     # 데이터 생성
│   ├── templates_juga.py   # 문서 렌더링
│   ├── batch_generator.py  # JU 배치 생성
│   ├── batch_generator_ga.py  # GA 배치 생성
│   ├── rotation_processor.py  # 회전 처리 (새로운)
│   ├── rotator.py          # 회전 처리 (기존)
│   └── extract_layout.py   # 레이아웃 추출
├── outputs/            # 생성 결과물 (Git 제외)
├── tests/              # 테스트 파일
└── README.md           # 프로젝트 문서
```

## 🔧 주요 기능

### 1. 데이터 생성
- **가짜 개인정보 생성**: 이름, 주민등록번호, 생년월일 등
- **개인정보 보호**: 100% 가짜 데이터만 사용
- **조건부 데이터 생성**: 자녀 수에 따른 배우자 포함 여부

### 2. 문서 렌더링
- **고품질 텍스트 렌더링**: KoPub World 폰트 사용
- **정확한 좌표 배치**: YAML 기반 레이아웃 정의
- **주민번호 마스킹**: OPEN/CLOSE 구분

### 3. 이미지 처리
- **4방향 회전**: 0°, 90°L, 90°R, 180°
- **일관된 파일명**: 체계적인 네이밍 규칙
- **메타데이터**: 완전한 매니페스트 파일

## 📋 특별 기능

### 주민등록등본(JU) 특화 기능
- **세대구성 사유 및 일자**: 11가지 사유 중 가중치 기반 선택
- **변동사유 빈칸 처리**: 30% 확률로 빈칸 생성
- **발생일/신고일**: 빈칸(5%), 대시(42.5%), 날짜(42.5%) 확률
- **세대원 수별 데이터**: 1명, 2명, 3-5명 지원

### 가족관계증명서(GA) 특화 기능
- **자녀 수별 배우자 로직**: 자녀 0명일 때 배우자 제외
- **템플릿별 자녀 수**: 0명, 1명, 2명, 3명 지원
- **관계 정보 출력**: 본인, 부, 모, 배우자, 자녀

## 🛠️ 개발 도구

### 레이아웃 추출 도구
```bash
python src/extract_layout.py
```
- GUI 기반 좌표 추출
- 실시간 미리보기
- YAML 형식 저장

### 테스트 스크립트
- `test_ju_logic.py`: JU 생성 로직 테스트
- `test_ga_spouse_logic.py`: GA 배우자 로직 테스트
- `test_household_weights.py`: 세대구성 사유 가중치 테스트

## 📈 데이터 품질

### 검증된 기능
- ✅ 정확한 세대원 수 생성 및 렌더링
- ✅ 주민번호 OPEN/CLOSE 구분
- ✅ 배우자 조건부 생성 (GA)
- ✅ 가중치 기반 랜덤 선택
- ✅ 4방향 회전 이미지 생성
- ✅ 일관된 파일명 규칙

### 품질 보장
- **고해상도 출력**: 원본 템플릿 품질 유지
- **정확한 좌표**: 수동 추출된 정밀 좌표 사용
- **다양한 변형**: 실제 문서와 유사한 변형 생성
- **메타데이터**: 완전한 매니페스트 파일 제공

## 🤝 기여

프로젝트에 기여하고 싶으시다면:
1. 이슈를 통해 버그나 개선사항을 보고해주세요
2. 풀 리퀘스트를 통해 코드 개선을 제안해주세요
3. 문서화 개선이나 테스트 추가를 도와주세요

## 📄 라이선스

이 프로젝트는 교육 및 연구 목적으로 개발되었습니다.

## 📞 문의

프로젝트에 대한 문의사항이 있으시면 이슈를 통해 연락해주세요.

---

**🎯 현재 상태**: 개선 작업 진행 중 - 새로운 파일명 규칙 및 OPEN/CLOSE 시스템 적용 